{"version":3,"sources":["hema/presentation/modules/vanStock/vanStockReservationHelper.ts"],"names":[],"mappings":"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","file":"vanStockReservationHelper.js","sourcesContent":["import { TransferVanStockItemViewModel } from \"./viewModels/transferVanStockItemViewModel\";\r\nimport { MaterialSearchResult } from \"../../../business/models/materialSearchResult\";\r\nimport { TransferVanStock } from \"./transferVanStock\";\r\nimport { DialogService } from \"aurelia-dialog\";\r\nimport { IVanStockService } from \"../../../business/services/interfaces/IVanStockService\";\r\n\r\nexport class VanStockReservationHelper {\r\n\r\n    public static async launchReservationDialog(\r\n            dialogService: DialogService,\r\n            vanStockService: IVanStockService,\r\n            materialSearchResult: MaterialSearchResult,\r\n            onComplete: (hasAResevationBeenMade: boolean) => Promise<void>\r\n        ): Promise<void> {\r\n\r\n        if (!materialSearchResult || !materialSearchResult.online) {\r\n            return;\r\n        }\r\n\r\n        let summary = `${materialSearchResult.stockReferenceId}\r\n                        - ${materialSearchResult.online.summary.totalParts}\r\n                        part${materialSearchResult.online.summary.totalParts > 1 ? \"s\" : \"\"}\r\n                        available nearby`;\r\n\r\n        let materials: TransferVanStockItemViewModel[] = [];\r\n\r\n        materialSearchResult.online.results.forEach(async r => {\r\n            let material = new TransferVanStockItemViewModel();\r\n            material.engineerId = r.id;\r\n            material.engineerName = r.name;\r\n            material.engineerPhone = r.phone;\r\n            material.distanceInMiles = r.distance;\r\n            material.quantityRequested = 0;\r\n            material.lat = r.lat;\r\n            material.lon = r.lon;\r\n            if (r.material) {\r\n                material.availableQuantity = r.material.quantity;\r\n            }\r\n            if (r.material.reservationQuantity) {\r\n                material.reservationQuantity = r.material.reservationQuantity;\r\n            }\r\n            material.owner = r.material.owner;\r\n            materials.push(material);\r\n        });\r\n\r\n        const result = await dialogService.open({ viewModel: TransferVanStock, model: materials, summary: summary });\r\n        if (result && !result.wasCancelled) {\r\n            const transfer: TransferVanStockItemViewModel[] = result.output as TransferVanStockItemViewModel[];\r\n            const promise: Promise<any>[] = [];\r\n            transfer.forEach(m => {\r\n                if (m.quantityRequested > 0) {\r\n                    promise.push(vanStockService.registerMaterialRequest({\r\n                        stockReferenceId: materialSearchResult.stockReferenceId,\r\n                        description: materialSearchResult.description,\r\n                        quantityRequested: m.quantityRequested,\r\n                        engineerId: m.engineerId,\r\n                        engineerName: m.engineerName,\r\n                        engineerPhone: m.engineerPhone,\r\n                        owner: m.owner\r\n                    }));\r\n                }\r\n            });\r\n            await Promise.all(promise);\r\n            await onComplete(!!promise.length);\r\n        }\r\n    }\r\n}\r\n"],"sourceRoot":"../../../.."}
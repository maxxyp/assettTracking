{"version":3,"sources":["hema/presentation/modules/vanStock/vanStock.ts"],"names":[],"mappings":"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","file":"vanStock.js","sourcesContent":["import {computedFrom, inject, observable} from \"aurelia-framework\";\nimport {BaseViewModel} from \"../../models/baseViewModel\";\nimport {ILabelService} from \"../../../business/services/interfaces/ILabelService\";\nimport {LabelService} from \"../../../business/services/labelService\";\nimport {EventAggregator} from \"aurelia-event-aggregator\";\nimport {DialogService} from \"aurelia-dialog\";\nimport {MaterialWithQuantities} from \"../../../business/models/materialWithQuantities\";\nimport {IVanStockService} from \"../../../business/services/interfaces/IVanStockService\";\nimport {VanStockService} from \"../../../business/services/vanStockService\";\nimport {ISort} from \"../../../common/models/ISort\";\nimport {VanStockServiceConstants} from \"../../../business/services/constants/vanStockServiceConstants\";\nimport {UpdateVanStockItem} from \"./updateVanStockItem\";\nimport {ReturnVanStockItem} from \"./returnVanStockItem\";\nimport {UpdateVanStockItemViewModel} from \"./viewModels/updateVanStockItemViewModel\";\nimport {ReturnVanStockItemViewModel} from \"./viewModels/returnVanStockItemViewModel\";\n\n@inject(LabelService, EventAggregator, DialogService, VanStockService)\nexport class VanStock extends BaseViewModel {\n\n    public material: MaterialWithQuantities[];\n    public hideLoadMore: boolean;\n    public sort: ISort;\n    @observable\n    public searchText: string;\n    public selectedRow: number;\n\n    private _vanStockService: IVanStockService;\n    private _currentCount: number;\n    private _myVanAreas: string[];\n    private readonly _pageSize: number;\n\n    constructor(labelService: ILabelService,\n                eventAggregator: EventAggregator,\n                dialogService: DialogService,\n                vanStockService: IVanStockService) {\n        super(labelService, eventAggregator, dialogService);\n        this._vanStockService = vanStockService;\n        this._pageSize = 1000;\n        this._currentCount = this._pageSize;\n        this.sort = {} as ISort;\n        this.hideLoadMore = false;\n        this._myVanAreas = [];\n        this.selectedRow = -1;\n    }\n\n    public async activateAsync(): Promise<void> {\n        this.sort.sortBy = \"stockReferenceId\";\n        this.sort.sortOrderAsc = true;\n        await this.populate();\n        this.showContent();\n    }\n\n    public async loadMore(): Promise<void> {\n        this._currentCount = this._currentCount + this._pageSize;\n        this.material = await this._vanStockService.searchLocalVanStock(this._currentCount, this.sort, this.searchText);\n        await this.showHideLoadMore(this.searchText);\n        await this.populateMyVanAreas();\n        return;\n    }\n\n    public async sortVanStock(sortProperty: string): Promise<void> {\n        this.sort.sortBy = sortProperty;\n        this.sort.sortOrderAsc = !this.sort.sortOrderAsc;\n        this.material = await this._vanStockService.searchLocalVanStock(this._currentCount, this.sort, this.searchText);\n        await this.populateMyVanAreas();\n        return;\n    }\n\n    public async searchTextChanged(newValue: string, oldValue: string): Promise<void> {\n        if (!newValue) {\n            newValue = \"\";\n        }\n        if (!oldValue) {\n            oldValue = \"\";\n        }\n        newValue = newValue.trim();\n        oldValue = oldValue.trim();\n        if (this.searchAutoCorrect(newValue, oldValue)) {\n            this.material = await this._vanStockService.searchLocalVanStock(this._currentCount, this.sort, newValue);\n            await this.showHideLoadMore(newValue);\n            await this.populateMyVanAreas();\n        }\n        return;\n    }\n\n    public async editVanStock(part: MaterialWithQuantities): Promise<void> {\n        this.selectedRow = -1;\n        let model: UpdateVanStockItemViewModel = {} as UpdateVanStockItemViewModel;\n        model.material = part;\n        model.myVanAreas = this._myVanAreas;\n        const result = await this._dialogService.open({viewModel: UpdateVanStockItem, model: model});\n        if (result) {\n            if (!result.wasCancelled) {\n                await this._vanStockService.registerMaterialZoneUpdate(result.output);\n                this.showInfo(\"My Van Stock Update\", \"Van stock updated.\");\n            }\n            await this.populate();\n        }\n        return;\n    }\n\n    public async returnVanStock(part: MaterialWithQuantities): Promise<void> {\n        this.selectedRow = -1;\n        let model: ReturnVanStockItemViewModel = {} as ReturnVanStockItemViewModel;\n        model.material = part;\n        const result = await this._dialogService.open({viewModel: ReturnVanStockItem, model: model});\n        if (result) {\n            if (!result.wasCancelled) {\n                await this._vanStockService.registerMaterialReturn({\n                    stockReferenceId: result.output.material.stockReferenceId,\n                    quantityReturned: result.output.quantityToReturn,\n                    reason: result.output.returnReason\n                });\n                this.showInfo(\"Material Return\", \"Material return requested.\");\n            }\n            await this.populate();\n        }\n        return;\n    }\n\n    @computedFrom(\"selectedRow\")\n    public get isEditing(): boolean {\n        return this.selectedRow !== -1;\n    }\n\n    public setNotEditing(): void {\n        this.setEditingRow(-1);\n    }\n\n    public setEditingRow(index: number): void {\n        this.selectedRow = index;\n    }\n\n    private searchAutoCorrect(newValue: string, oldValue: string): boolean {\n        if (newValue && (newValue.length === 1 && newValue === \"@\")) {\n            this.searchText = VanStockServiceConstants.AREA_SEARCH_PREFIX;\n            return false;\n        }\n        if (newValue && (newValue.length === 1 && newValue === \"#\")) {\n            this.searchText = VanStockServiceConstants.JOB_SEARCH_PREFIX;\n            return false;\n        }\n        if (oldValue && newValue && newValue.length < oldValue.length) { // deleting text\n            if (oldValue.trim() === VanStockServiceConstants.AREA_SEARCH_PREFIX\n                || oldValue.trim() === VanStockServiceConstants.JOB_SEARCH_PREFIX) {\n                this.searchText = undefined;\n            }\n        }\n        return true;\n    }\n\n    private async populateMyVanAreas(): Promise<void> {\n        this._myVanAreas = await this._vanStockService.getLocalVanStockAreaLookup();\n    }\n\n    private async populate(): Promise<void> {\n        const material = await this._vanStockService.searchLocalVanStock(this._currentCount, this.sort, this.searchText);\n        if (material) {\n            this.material = material;\n            await this.showHideLoadMore(this.searchText);\n            await this.populateMyVanAreas();\n        }\n    }\n\n    private async showHideLoadMore(searchText: string): Promise<void> {\n        const totalVanStockCount = await this._vanStockService.getLocalVanStockLineTotal(searchText);\n        this.hideLoadMore = totalVanStockCount === this.material.length;\n    }\n\n}\n"],"sourceRoot":"../../../.."}
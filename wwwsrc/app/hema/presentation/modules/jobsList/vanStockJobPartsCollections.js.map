{"version":3,"sources":["hema/presentation/modules/jobsList/vanStockJobPartsCollections.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAqBA;QAAiD,+CAAa;QAc1D,qCAAY,YAA2B,EAC3B,eAAgC,EAChC,aAA4B,EAC5B,OAA6B,EAC7B,eAAiC,EACjC,eAAiC,EACjC,UAAuB,EACvB,MAAc;YAP1B,YAQI,kBAAM,YAAY,EAAE,eAAe,EAAE,aAAa,CAAC,SAMtD;YALG,KAAI,CAAC,OAAO,GAAG,OAAO,CAAC;YACvB,KAAI,CAAC,eAAe,GAAG,eAAe,CAAC;YACvC,KAAI,CAAC,gBAAgB,GAAG,eAAe,CAAC;YACxC,KAAI,CAAC,WAAW,GAAG,UAAU,CAAC;YAC9B,KAAI,CAAC,OAAO,GAAG,MAAM,CAAC;;QAC1B,CAAC;QAEY,mDAAa,GAA1B,UAA2B,MAA2B;;;;;;;4BAClD,IAAI,CAAC,MAAM,GAAG,MAAM,IAAI,MAAM,CAAC,MAAM,CAAC;4BACtC,IAAI,CAAC,cAAc,GAAG;gCAClB,IAAI,CAAC,gBAAgB,CAAC,SAAS,CAAC,yCAAmB,CAAC,iBAAiB,EAAE,cAAM,OAAA,KAAI,CAAC,MAAM,EAAE,EAAb,CAAa,CAAC;6BAC9F,CAAC;4BAEwB,qBAAM,IAAI,CAAC,gBAAgB,CAAC,iBAAiB,EAAE,EAAA;;4BAAnE,gBAAgB,GAAG,CAAC,SAA+C,CAAC,CAAC,SAAS;4BACpF,IAAI,CAAC,gBAAgB,GAAG,CAAC,gBAAgB,IAAI,EAAE,CAAC,CAAC;4BAEjD,qBAAM,IAAI,CAAC,MAAM,EAAE,EAAA;;4BAAnB,SAAmB,CAAC;;;;;SACvB;QAEY,yEAAmC,GAAhD,UAAiD,CAAQ;;;;;4BACrD,IAAI,CAAC,kBAAkB,CAAC,CAAC,CAAC,CAAC;4BAC3B,qBAAM,IAAI,CAAC,kBAAkB,EAAE,EAAA;;4BAA/B,SAA+B,CAAC;4BAChC,IAAI,CAAC,OAAO,CAAC,eAAe,CAAC,gCAAgC,CAAC,CAAC;;;;;SAClE;QAEY,+DAAyB,GAAtC,UAAuC,CAAQ;;;oBAC3C,IAAI,CAAC,kBAAkB,CAAC,CAAC,CAAC,CAAC;oBAC3B,IAAI,CAAC,OAAO,CAAC,eAAe,CAAC,gCAAgC,CAAC,CAAC;;;;SAClE;QAEY,mDAAa,GAA1B;;;oBACI,IAAI,CAAC,cAAc,CAAC,OAAO,CAAC,UAAA,YAAY,IAAI,OAAA,YAAY,CAAC,OAAO,EAAE,EAAtB,CAAsB,CAAC,CAAC;;;;SACvE;QAEM,+DAAyB,GAAhC,UAAiC,CAAQ;YACrC,IAAI,CAAC,OAAO,CAAC,eAAe,CAAC,gCAAgC,CAAC,CAAC;YAC/D,IAAI,CAAC,kBAAkB,CAAC,CAAC,CAAC,CAAC;QAC/B,CAAC;QAGD,sBAAW,2DAAkB;iBAA7B;gBACI,IAAI,UAAU,GAAG,IAAI,CAAC,gBAAgB,CAAC,CAAC,CAAC,IAAI,CAAC,gBAAgB,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC;gBAC1E,MAAM,CAAC,cAAY,2BAAY,CAAC,SAAS,CAAC,UAAU,EAAE,MAAM,CAAC,0BAAuB,CAAC;YACzF,CAAC;;;WAAA;QAEa,4CAAM,GAApB;;;;;gCACsB,qBAAM,IAAI,CAAC,WAAW,CAAC,cAAc,EAAE,EAAA;;4BAArD,WAAW,GAAG,SAAuC;4BACzD,IAAI,CAAC,OAAO,GAAG,CAAC,WAAW,CAAC;;;;;SAC/B;QAEa,wDAAkB,GAAhC;;;;;4BACI,IAAI,CAAC,eAAe,CAAC,0BAA0B,GAAG,IAAI,CAAC;4BACvD,qBAAM,IAAI,CAAC,eAAe,CAAC,SAAS,CAAC,iCAAe,CAAC,qBAAqB,CAAC,EAAA;;4BAA3E,SAA2E,CAAC;;;;;SAC/E;QAEO,wDAAkB,GAA1B,UAA2B,KAAY;YACnC,EAAE,CAAC,CAAC,KAAK,KAAK,IAAI,CAAC,CAAC,CAAC;gBACjB,KAAK,CAAC,eAAe,EAAE,CAAC;gBACxB,iBAAG,CAAC,aAAa,CAAC,IAAI,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC;YAC1C,CAAC;QACL,CAAC;QApBD;YADC,8BAAY,CAAC,kBAAkB,CAAC;;;6EAIhC;QAlEQ,2BAA2B;YADvC,qCAAM,CAAC,2BAAY,EAAE,0CAAe,EAAE,8BAAa,EAAE,2CAAoB,EAAE,iCAAe,EAAE,iCAAe,EAAE,uBAAU,EAAE,uBAAM,CAAC;qDAgBhG,0CAAe;gBACjB,8BAAa;gBACnB,2CAAoB,0BAIrB,uBAAM;WArBjB,2BAA2B,CAoFvC;QAAD,kCAAC;KApFD,AAoFC,CApFgD,6BAAa,GAoF7D;IApFY,kEAA2B","file":"vanStockJobPartsCollections.js","sourcesContent":["import {inject} from \"aurelia-dependency-injection\";\nimport {BaseViewModel} from \"../../models/baseViewModel\";\nimport {ILabelService} from \"../../../business/services/interfaces/ILabelService\";\nimport {LabelService} from \"../../../business/services/labelService\";\nimport {EventAggregator, Subscription} from \"aurelia-event-aggregator\";\nimport {DialogService} from \"aurelia-dialog\";\nimport {WorkRetrievalTracker} from \"../../../business/services/workRetrievalTracker\";\nimport {EngineerService} from \"../../../business/services/engineerService\";\nimport {IEngineerService} from \"../../../business/services/interfaces/IEngineerService\";\nimport {JobService} from \"../../../business/services/jobService\";\nimport {IJobService} from \"../../../business/services/interfaces/IJobService\";\nimport {computedFrom} from \"aurelia-binding\";\nimport {StringHelper} from \"../../../../common/core/stringHelper\";\nimport {Router} from \"aurelia-router\";\nimport {DOM} from \"aurelia-pal\";\nimport {IVanStockService} from \"../../../business/services/interfaces/IVanStockService\";\nimport {Material} from \"../../../business/models/material\";\nimport {VanStockService} from \"../../../business/services/vanStockService\";\nimport {JobServiceConstants} from \"../../../business/services/constants/jobServiceConstants\";\n\n@inject(LabelService, EventAggregator, DialogService, WorkRetrievalTracker, EngineerService, VanStockService, JobService, Router)\nexport class VanStockJobPartsCollections extends BaseViewModel {\n    public partsCollections: Material[];\n    public tracker: WorkRetrievalTracker;\n    public enabled: boolean;\n    public engineerService: IEngineerService;\n    public isDone: boolean;\n\n    // private _subscriptions: Subscription[];\n    private _router: Router;\n    private _vanStockService: IVanStockService;\n    private _jobService: IJobService;\n\n    private _subscriptions: Subscription[];\n\n    constructor(labelService: ILabelService,\n                eventAggregator: EventAggregator,\n                dialogService: DialogService,\n                tracker: WorkRetrievalTracker,\n                engineerService: IEngineerService,\n                vanStockService: IVanStockService,\n                jobService: IJobService,\n                router: Router) {\n        super(labelService, eventAggregator, dialogService);\n        this.tracker = tracker;\n        this.engineerService = engineerService;\n        this._vanStockService = vanStockService;\n        this._jobService = jobService;\n        this._router = router;\n    }\n\n    public async activateAsync(params: { isDone: boolean }): Promise<void> {\n        this.isDone = params && params.isDone;\n        this._subscriptions = [\n            this._eventAggregator.subscribe(JobServiceConstants.JOB_STATE_CHANGED, () => this.update()),\n        ];\n\n        const partsCollections = (await this._vanStockService.getPartsToCollect()).toCollect;\n        this.partsCollections = (partsCollections || []);\n\n        await this.update();\n    }\n\n    public async collectAndNavigateToPartsCollection(e: Event): Promise<void> {\n        this.dispatchClickEvent(e);\n        await this.setCollectingParts();\n        this._router.navigateToRoute(\"vanStockPartsCollectionDetails\");\n    }\n\n    public async continueToPartsCollection(e: Event): Promise<void> {\n        this.dispatchClickEvent(e);\n        this._router.navigateToRoute(\"vanStockPartsCollectionDetails\");\n    }\n\n    public async detachedAsync(): Promise<void> {\n        this._subscriptions.forEach(subscription => subscription.dispose());\n    }\n\n    public navigateToPartsCollection(e: Event): void {\n        this._router.navigateToRoute(\"vanStockPartsCollectionDetails\");\n        this.dispatchClickEvent(e);\n    }    \n\n    @computedFrom(\"partsCollections\")\n    public get summaryDescription(): string {\n        let totalParts = this.partsCollections ? this.partsCollections.length : 0;\n        return `You have ${StringHelper.pluralise(totalParts, \"part\")} ready for collection`;\n    }\n\n    private async update(): Promise<void> {\n        let activeJobId = await this._jobService.getActiveJobId();\n        this.enabled = !activeJobId;\n    }\n\n    private async setCollectingParts(): Promise<void> {\n        this.engineerService.isPartCollectionInProgress = true;\n        await this.engineerService.setStatus(EngineerService.OBTAINING_MATS_STATUS);\n    }\n\n    private dispatchClickEvent(event: Event): void {\n        if (event !== null) {\n            event.stopPropagation();\n            DOM.dispatchEvent(new Event(\"click\"));\n        }\n    }\n}\n"],"sourceRoot":"../../../.."}
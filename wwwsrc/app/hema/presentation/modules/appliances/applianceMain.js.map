{"version":3,"sources":["hema/presentation/modules/appliances/applianceMain.ts"],"names":[],"mappings":"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","file":"applianceMain.js","sourcesContent":["/// <reference path=\"./../../../../../typings/app.d.ts\" />\n\nimport { inject } from \"aurelia-dependency-injection\";\nimport { Router, RouterConfiguration, RouteConfig, NavigationInstruction } from \"aurelia-router\";\nimport { IJobService } from \"../../../business/services/interfaces/IJobService\";\nimport { JobService } from \"../../../business/services/jobService\";\n\nimport { LabelService } from \"../../../business/services/labelService\";\nimport { ILabelService } from \"../../../business/services/interfaces/ILabelService\";\nimport { EventAggregator, Subscription } from \"aurelia-event-aggregator\";\nimport { IApplianceService } from \"../../../business/services/interfaces/IApplianceService\";\nimport { ApplianceService } from \"../../../business/services/applianceService\";\nimport { Appliance } from \"../../../business/models/appliance\";\nimport { DataState } from \"../../../business/models/dataState\";\nimport { EditableViewModel } from \"../../models/editableViewModel\";\nimport { CatalogService } from \"../../../business/services/catalogService\";\nimport { BusinessRuleService } from \"../../../business/services/businessRuleService\";\nimport { ValidationService } from \"../../../business/services/validationService\";\nimport { IValidationService } from \"../../../business/services/interfaces/IValidationService\";\nimport { IBusinessRuleService } from \"../../../business/services/interfaces/IBusinessRuleService\";\nimport { ICatalogService } from \"../../../business/services/interfaces/ICatalogService\";\nimport { IEngineerService } from \"../../../business/services/interfaces/IEngineerService\";\nimport { EngineerService } from \"../../../business/services/engineerService\";\nimport { Guid } from \"../../../../common/core/guid\";\nimport { DialogService } from \"aurelia-dialog\";\nimport { JobServiceConstants } from \"../../../business/services/constants/jobServiceConstants\";\nimport { DataStateSummary } from \"../../../business/models/dataStateSummary\";\nimport { ApplianceDetailsConstants } from \"../../constants/applianceDetailsConstants\";\nimport { AnimationService } from \"../../../../common/ui/services/animationService\";\nimport { IAnimationService } from \"../../../../common/ui/services/IAnimationService\";\nimport { IAppLauncher } from \"../../../../common/core/services/IAppLauncher\";\nimport { IConfigurationService } from \"../../../../common/core/services/IConfigurationService\";\nimport { AppLauncher } from \"../../../../common/core/services/appLauncher\";\nimport { ConfigurationService } from \"../../../../common/core/services/configurationService\";\nimport { IHemaConfiguration } from \"../../../IHemaConfiguration\";\nimport { observable } from \"aurelia-binding\";\nimport {ApplianceSafetyType} from \"../../../business/models/applianceSafetyType\";\nimport {IPageService} from \"../../services/interfaces/IPageService\";\nimport {PageService} from \"../../services/pageService\";\nimport { ObjectHelper } from \"../../../../common/core/objectHelper\";\n\n@inject(LabelService, JobService, EngineerService, EventAggregator, DialogService, ValidationService, BusinessRuleService, CatalogService,\n    ApplianceService, AnimationService, AppLauncher, ConfigurationService, PageService)\nexport class ApplianceMain extends EditableViewModel {\n\n    public router: Router;\n    public applianceIds: string[];\n    public title: string;\n    public isNew: boolean;\n\n    public appliance: Appliance;\n    public card: HTMLElement;\n    public applianceType: string;\n\n    public description: string;\n    public gcCode: string;\n    @observable()\n    public applianceSafetyType: ApplianceSafetyType;\n    @observable()\n    public isInstPremAppliance: boolean;\n    public isFullScreen : boolean;\n\n    private _childRoutes: RouteConfig[];\n\n    private _applianceId: string;\n    private _applianceService: IApplianceService;\n    private _jobDataStateSubscription: Subscription;\n    private _applianceDetailsSubscription: Subscription;\n\n    private _itemPosition: number;\n    private _animationService: IAnimationService;\n    private _appLauncher: IAppLauncher;\n    private _configurationService: IConfigurationService;\n    private _pageService: IPageService;\n    private _landingPage: string;\n\n    constructor(labelService: ILabelService,\n        jobService: IJobService,\n        engineerService: IEngineerService,\n        eventAggregator: EventAggregator,\n        dialogService: DialogService,\n        validationService: IValidationService,\n        businessRuleService: IBusinessRuleService,\n        catalogService: ICatalogService,\n        applianceService: IApplianceService,\n        animationService: IAnimationService,\n        appLauncher: IAppLauncher,\n        configurationService: IConfigurationService,\n        pageService: IPageService) {\n        super(jobService, engineerService, labelService, eventAggregator, dialogService, validationService, businessRuleService, catalogService);\n        this._applianceService = applianceService;\n        this._animationService = animationService;\n        this._appLauncher = appLauncher;\n        this._configurationService = configurationService;\n        this.isFullScreen = window.isFullScreen;    \n        this._pageService = pageService;           \n    }\n\n    public configureRouter(config: RouterConfiguration, childRouter: Router, ...args: any[]): void {\n        this.router = childRouter;\n        this._landingPage = (args && \n                                args.length >= 3 && \n                                args[2] instanceof NavigationInstruction && \n                                (<NavigationInstruction> args[2]).params && \n                                (<NavigationInstruction> args[2]).params.applianceId) ? \n                                    this._pageService.getLastVisitedPage(ObjectHelper.getClassName(this), (<NavigationInstruction> args[2]).params.applianceId) || \"appliance-details\" :\n                                    \"appliance-details\";\n        this.setupChildRoutes();\n        config.map(this._childRoutes);\n    }\n\n    public activateAsync(params: { jobId: string, applianceId: string }): Promise<any> {\n        this._applianceId = params.applianceId;\n        this.isNew = this._applianceId === Guid.empty;\n\n        return this.loadBusinessRules()\n            .then(() => this.load());\n    }\n\n    public deactivateAsync(): Promise<void> {\n        if (this._jobDataStateSubscription) {\n            this._jobDataStateSubscription.dispose();\n            this._jobDataStateSubscription = null;\n        }\n\n        if (this._applianceDetailsSubscription) {\n            this._applianceDetailsSubscription.dispose();\n            this._applianceDetailsSubscription = null;\n        }\n\n        return Promise.resolve();\n    }\n\n    public navigateToRoute(name: string): void {\n        this.router.navigateToRoute(name);\n    }\n\n    public swipeFunction(swipeDirection: string): void {\n        if (this._itemPosition !== -1) {\n            if (swipeDirection === \"left\") {\n                this._animationService.swipe(this.card, this.applianceIds, this._itemPosition, swipeDirection, \"slide-in-right\", \"slide-out-left\", 300).then((position) => {\n                    this.router.parent.navigate(this.router.parent.currentInstruction.fragment.replace(this.applianceIds[this._itemPosition], this.applianceIds[position]));\n                    this._itemPosition = position;\n                })\n                    .catch();\n            } else {\n                this._animationService.swipe(this.card, this.applianceIds, this._itemPosition, swipeDirection, \"slide-in-left\", \"slide-out-right\", 300).then((position) => {\n                    this.router.parent.navigate(this.router.parent.currentInstruction.fragment.replace(this.applianceIds[this._itemPosition], this.applianceIds[position]));\n                    this._itemPosition = position;\n                })\n                    .catch();\n            }\n        }\n    }\n\n    public launchAdapt(gcCode: string): void {\n        this._appLauncher.launchApplication(this._configurationService.getConfiguration<IHemaConfiguration>().adaptLaunchUri + \" \" + gcCode);\n    }\n\n    protected stateChanged(): Promise<void> {\n        return super.stateChanged()\n            .then(() => {                    \n                if (!this.canEdit) {\n                    this.router.navigateToRoute(\"appliance-details\");\n                } \n            });\n    }\n\n   protected loadModel(): Promise<void> {\n         return this._applianceService.getAppliances(this.jobId)\n            .then((appliances) => {\n                this.applianceIds = appliances.map(a => a.id);\n                this.appliance = appliances.find(a => a.id === this._applianceId);\n\n                if (this.isNew) {\n                    this.description = \"\";\n                    this._itemPosition = -1;\n                } else {\n                    this.applianceSafetyType = this.appliance.applianceSafetyType;\n                    this.isInstPremAppliance = this.appliance.isInstPremAppliance;\n                    this.applianceType = this.appliance.applianceType;\n                    this.updateApplianceDetails(this.appliance.description, this.appliance.gcCode);\n                    this._itemPosition = this.applianceIds.indexOf(this.appliance.id);\n                }\n                this._applianceDetailsSubscription = this._eventAggregator.subscribe(ApplianceDetailsConstants.DETAILS_CHANGED,\n                    (arg: { description: string, gccode: string }) => this.updateApplianceDetails(arg.description, arg.gccode));\n\n                this._jobDataStateSubscription = this._eventAggregator.subscribe(JobServiceConstants.JOB_DATA_STATE_CHANGED, () => this.updateDataState());\n                this.updateDataState();\n                this.showContent();\n                this.scrollToTop();\n            });\n     }\n\n    private updateApplianceDetails(description: string, gccode: string): Promise<void> {\n        return this._applianceService.isFullGcCode(gccode)\n            .then(isFullGcCode => {\n                this.gcCode = isFullGcCode ? gccode : \"\";\n                this.description = description;\n            });\n    }\n\n    private setupChildRoutes(): void {\n\n        this._childRoutes = [\n            {\n                route: \"\",\n                redirect: this._landingPage\n            },\n            {\n                route: \"appliance-details\",\n                moduleId: \"hema/presentation/modules/appliances/applianceDetails\",\n                name: \"appliance-details\",\n                nav: true,\n                title: \"Appliance Details\",\n                settings: {\n                    tabGroupParent: \"appliances\",\n                    dataState: DataState.valid,\n                    alwaysShow: true,\n                    hideIfInstPrem: false\n                }\n            },\n            {\n                route: \"reading\",\n                moduleId: \"hema/presentation/modules/appliances/applianceReading\",\n                name: \"reading\",\n                nav: true,\n                title: \"Appliance Reading\",\n                settings: {\n                    dataState: DataState.dontCare,\n                    applianceSafetyType: ApplianceSafetyType.gas,\n                    hideIfInstPrem: true\n                }\n            },\n            {\n                route: \"gas-safety\",\n                moduleId: \"hema/presentation/modules/appliances/gasSafety\",\n                name: \"gas-safety\",\n                nav: true,\n                title: \"Gas Safety\",\n                settings: {\n                    dataState: DataState.dontCare,\n                    applianceSafetyType: ApplianceSafetyType.gas,\n                    hideIfInstPrem: true\n                }\n            },\n            {\n                route: \"previous-gas-safety\",\n                moduleId: \"hema/presentation/modules/appliances/prevGasSafety\",\n                name: \"previous-gas-safety\",\n                nav: true,\n                title: \"Previous Unsafe Situation\",\n                settings: {\n                    dataState: DataState.dontCare,\n                    applianceSafetyType: ApplianceSafetyType.gas,\n                    alwaysShow: true,\n                    hideIfInstPrem: true\n                }\n            },\n            {\n                route: \"electrical-safety\",\n                moduleId: \"hema/presentation/modules/appliances/electricalSafety\",\n                name: \"electrical-safety\",\n                nav: true,\n                title: \"Electrical Safety\",\n                settings: {\n                    dataState: DataState.valid,\n                    applianceSafetyType: ApplianceSafetyType.electrical,\n                    hideIfInstPrem: true\n                }\n            },\n            {\n                route: \"previous-electrical-unsafe-detail\",\n                moduleId: \"hema/presentation/modules/appliances/previousElectricalUnsafeDetail\",\n                name: \"previous-electrical-unsafe-detail\",\n                nav: true,\n                title: \"Previous Electrical Unsafe Detail\",\n                settings: {\n                    dataState: DataState.dontCare,\n                    applianceSafetyType: ApplianceSafetyType.electrical,\n                    alwaysShow: true,\n                    hideIfInstPrem: true\n                }\n            },\n            {\n                route: \"other-safety\",\n                moduleId: \"hema/presentation/modules/appliances/otherSafety\",\n                name: \"other-safety\",\n                nav: true,\n                title: \"Other Safety\",\n                settings: {\n                    dataState: DataState.dontCare,\n                    applianceSafetyType: ApplianceSafetyType.other,\n                    hideIfInstPrem: true\n                }\n            },\n            {\n                route: \"previous-other-safety\",\n                moduleId: \"hema/presentation/modules/appliances/prevOtherSafety\",\n                name: \"previous-other-safety\",\n                nav: true,\n                title: \"Previous Unsafe Situation\",\n                settings: {\n                    dataState: DataState.dontCare,\n                    applianceSafetyType: ApplianceSafetyType.other,\n                    alwaysShow: true,\n                    hideIfInstPrem: true\n                }\n            }\n        ];\n    }\n\n    private updateDataState(): Promise<void> {\n        if (this.isNew) {\n            return null;\n        }\n\n        let isDataStateOverridden = DataStateSummary.dataStateCompletionOverrideGroup !== undefined;\n        if (isDataStateOverridden) {\n            this.router.routes\n                .filter(rt => !rt.redirect)\n                .forEach(rt => rt.settings.dataState = DataState.dontCare);\n            return null;\n        }\n\n        return this._applianceService.getAppliance(this.jobId, this._applianceId)\n            .then(appliance => {\n                let applianceRoute = this.router.routes.find(r => r.route === \"appliance-details\");\n                applianceRoute.settings.dataState = appliance.dataState;\n\n                if (this.appliance.applianceSafetyType === ApplianceSafetyType.electrical) {\n                    let electricalApplianceSafetyRoute = this.router.routes.find(r => r.route === \"electrical-safety\");\n                    electricalApplianceSafetyRoute.settings.dataState = appliance.safety.applianceElectricalSafetyDetail.dataState;\n\n                } else if (this.appliance.applianceSafetyType === ApplianceSafetyType.gas) {\n                    let readingRoute = this.router.routes.find(r => r.route === \"reading\");\n                    readingRoute.settings.dataState = appliance.safety.applianceGasReadingsMaster.dataState;\n\n                    let gasSafetyRoute = this.router.routes.find(r => r.route === \"gas-safety\");\n                    gasSafetyRoute.settings.dataState = appliance.safety.applianceGasSafety.dataState;\n\n                } else if (this.appliance.applianceSafetyType === ApplianceSafetyType.other) {\n                    let otherApplianceSafetyRoute = this.router.routes.find(r => r.route === \"other-safety\");\n                    otherApplianceSafetyRoute.settings.dataState = appliance.safety.applianceOtherSafety.dataState;\n                }\n            });\n    }    \n}\n"],"sourceRoot":"../../../.."}
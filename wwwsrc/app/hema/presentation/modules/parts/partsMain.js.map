{"version":3,"sources":["hema/presentation/modules/parts/partsMain.ts"],"names":[],"mappings":"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","file":"partsMain.js","sourcesContent":["/// <reference path=\"./../../../../../typings/app.d.ts\" />\r\n\r\nimport {inject} from \"aurelia-dependency-injection\";\r\nimport {Router, RouterConfiguration, RouteConfig} from \"aurelia-router\";\r\nimport {IJobService} from \"../../../business/services/interfaces/IJobService\";\r\nimport {JobService} from \"../../../business/services/jobService\";\r\nimport {LabelService} from \"../../../business/services/labelService\";\r\nimport {ILabelService} from \"../../../business/services/interfaces/ILabelService\";\r\nimport {EventAggregator, Subscription} from \"aurelia-event-aggregator\";\r\nimport {DataState} from \"../../../business/models/dataState\";\r\nimport {ICatalogService} from \"../../../business/services/interfaces/ICatalogService\";\r\nimport {IBusinessRuleService} from \"../../../business/services/interfaces/IBusinessRuleService\";\r\nimport {IValidationService} from \"../../../business/services/interfaces/IValidationService\";\r\nimport {CatalogService} from \"../../../business/services/catalogService\";\r\nimport {BusinessRuleService} from \"../../../business/services/businessRuleService\";\r\nimport {ValidationService} from \"../../../business/services/validationService\";\r\nimport {EditableViewModel} from \"../../models/editableViewModel\";\r\nimport {EngineerService} from \"../../../business/services/engineerService\";\r\nimport {IEngineerService} from \"../../../business/services/interfaces/IEngineerService\";\r\nimport {DialogService} from \"aurelia-dialog\";\r\nimport {JobServiceConstants} from \"../../../business/services/constants/jobServiceConstants\";\r\nimport {DataStateSummary} from \"../../../business/models/dataStateSummary\";\r\nimport {IPageService} from \"../../services/interfaces/IPageService\";\r\nimport {PageService} from \"../../services/pageService\";\r\nimport { ObjectHelper } from \"../../../../common/core/objectHelper\";\r\n\r\n@inject(LabelService, JobService, EngineerService, EventAggregator, DialogService, ValidationService, BusinessRuleService, CatalogService, PageService)\r\nexport class PartsMain extends EditableViewModel {\r\n    public router: Router;\r\n    public isFullScreen: boolean;\r\n\r\n    private _childRoutes: RouteConfig[];\r\n    private _jobDataStateSubscription: Subscription;\r\n    private _pageService: IPageService;\r\n\r\n    constructor(labelService: ILabelService,\r\n                jobService: IJobService,\r\n                engineerService: IEngineerService,\r\n                eventAggregator: EventAggregator,\r\n                dialogService: DialogService,\r\n                validationService: IValidationService,\r\n                businessRuleService: IBusinessRuleService,\r\n                catalogService: ICatalogService,\r\n                pageService: IPageService) {\r\n        super(jobService, engineerService, labelService, eventAggregator, dialogService, validationService, businessRuleService, catalogService);\r\n        this.isFullScreen = window.isFullScreen;\r\n        this._pageService = pageService;\r\n    }\r\n\r\n    public configureRouter(config: RouterConfiguration, childRouter: Router): void {\r\n        this.router = childRouter;\r\n        this.setupChildRoutes();\r\n        config.map(this._childRoutes);\r\n    }\r\n\r\n    public activateAsync(params: { jobId: string }): Promise<any> {\r\n        return this.load()\r\n                .then(() => this.showContent());\r\n    }\r\n\r\n    public deactivateAsync(): Promise<void> {\r\n        if (this._jobDataStateSubscription) {\r\n            this._jobDataStateSubscription.dispose();\r\n            this._jobDataStateSubscription = null;\r\n        }\r\n\r\n        return Promise.resolve();\r\n    }\r\n\r\n    public navigateToRoute(name: string): void {\r\n        this.router.navigateToRoute(name);\r\n    }\r\n\r\n    protected stateChanged(): Promise<void> {\r\n        return super.stateChanged()\r\n            .then(() => {\r\n                if (!this.canEdit) {                    \r\n                    this.router.navigateToRoute(\"previously-fitted-parts\");\r\n                }\r\n\r\n                this._childRoutes.find(config => config.name === \"consumables-favourites\").settings.alwaysShow = this.canEdit;\r\n            });\r\n    }\r\n\r\n    protected loadModel(): Promise<void> {\r\n                this._jobDataStateSubscription = this._eventAggregator.subscribe(JobServiceConstants.JOB_DATA_STATE_CHANGED, () => this.updateDataState());\r\n        this.updateDataState();\r\n        return Promise.resolve();\r\n    }\r\n\r\n    private getRedirectRoute(): string {\r\n        let landingPage = this._pageService.getLastVisitedPage(ObjectHelper.getClassName(this));\r\n        return landingPage || \"todays-parts\";\r\n    }\r\n\r\n    private setupChildRoutes(): void {\r\n        this._childRoutes = [{\r\n            route: \"\",\r\n            redirect: this.getRedirectRoute()\r\n        }];\r\n\r\n        this._childRoutes.push({\r\n            route: \"todays-parts\",\r\n            moduleId: \"hema/presentation/modules/parts/todaysParts\",\r\n            name: \"todays-parts\",\r\n            nav: true,\r\n            title: \"Today's Parts\",\r\n            settings: {\r\n                tabGroupParent: \"parts\",\r\n                dataState: DataState.dontCare,\r\n                alwaysShow: true\r\n            }\r\n        });\r\n        this._childRoutes.push({\r\n            route: \"parts-basket\",\r\n            moduleId: \"hema/presentation/modules/parts/partsBasket\",\r\n            name: \"parts-basket\",\r\n            nav: true,\r\n            title: \"Parts Basket\",\r\n            settings: {\r\n                tabGroupParent: \"parts\",\r\n                dataState: DataState.dontCare,\r\n                alwaysShow: true\r\n            }\r\n        });\r\n        this._childRoutes.push({\r\n            route: \"previously-fitted-parts\",\r\n            moduleId: \"hema/presentation/modules/parts/previouslyFittedParts\",\r\n            name: \"previously-fitted-parts\",\r\n            nav: true,\r\n            title: \"Previously Fitted Parts\",\r\n            settings: {\r\n                tabGroupParent: \"parts\",\r\n                dataState: DataState.dontCare,\r\n                alwaysShow: true\r\n            }\r\n        });\r\n        this._childRoutes.push({\r\n            route: \"consumables-favourites\",\r\n            moduleId: \"hema/presentation/modules/parts/consumablesFavourites\",\r\n            name: \"consumables-favourites\",\r\n            nav: true,\r\n            title: \"Favourites\",\r\n            settings: {\r\n                dataState: DataState.dontCare,\r\n                alwaysShow: this.canEdit\r\n            }\r\n        });\r\n    }\r\n\r\n    private updateDataState(): void {\r\n        let isActivitiesOverride = DataStateSummary.dataStateCompletionOverrideGroup === \"activities\";\r\n        let partsBasketRoute = this._childRoutes.find(r => r.route === \"parts-basket\");\r\n        let todaysPartsRoute = this._childRoutes.find(r => r.route === \"todays-parts\");\r\n\r\n        if (isActivitiesOverride) {\r\n            partsBasketRoute.settings.dataState = DataState.dontCare;\r\n            todaysPartsRoute.settings.dataState = DataState.dontCare;\r\n        } else {\r\n             this._jobService.getJob(this.jobId)\r\n                .then((job) => {\r\n                    if (job) {\r\n                        partsBasketRoute.settings.dataState = job.partsDetail && job.partsDetail.partsBasket\r\n                            ? job.partsDetail.partsBasket.dataState\r\n                            : DataState.dontCare;\r\n\r\n                        todaysPartsRoute.settings.dataState = job.partsDetail && job.partsDetail.partsToday\r\n                            ? job.partsDetail.partsToday.dataState\r\n                            : DataState.dontCare;\r\n                    }\r\n                });\r\n        }\r\n    }\r\n}\r\n"],"sourceRoot":"../../../.."}
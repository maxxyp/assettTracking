{"version":3,"sources":["hema/presentation/services/pageService.ts"],"names":[],"mappings":"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","file":"pageService.js","sourcesContent":["import { inject } from \"aurelia-dependency-injection\";\nimport { PageModel } from \"../models/pageModel\";\nimport { IPageService } from \"./interfaces/IPageService\";\nimport { EventAggregator } from \"aurelia-event-aggregator\";\nimport { JobServiceConstants } from \"../../business/services/constants/jobServiceConstants\";\nimport { ILabelService } from \"../../business/services/interfaces/ILabelService\";\nimport { LabelService } from \"../../business/services/labelService\";\nimport { ObjectHelper } from \"../../../common/core/objectHelper\";\nimport { StringHelper } from \"../../../common/core/stringHelper\";\n\n@inject(EventAggregator, LabelService)\nexport class PageService implements IPageService {\n    private _pageModels: PageModel[];\n    private _eventAggregator: EventAggregator;\n    private _labelService: ILabelService;\n    private _labels: { [key: string]: string };\n\n    constructor(eventAggregator: EventAggregator, labelService: ILabelService) {\n        this._pageModels = [];\n        this._eventAggregator = eventAggregator;\n        this._eventAggregator.subscribe(JobServiceConstants.JOB_STATE_CHANGED, () => this.clearPageVisitedHistory());\n        this._labelService = labelService;\n    }\n\n    public async addOrUpdateLastVisitedPage(url: string): Promise<void> {\n        let pageName: string = await this.getPageName(url);\n        if (pageName) {\n            let isPageItemIDRequired: boolean = this.isPageItemIDRequired(url);\n            let urlVals = this.getRouteNameAndPageItemId(url, pageName, isPageItemIDRequired);\n            let pageModel = this._pageModels.length > 0 ? this._pageModels.find(p => p.pageName === pageName && p.itemId === urlVals.pageItemId) : undefined;\n\n            if (urlVals.routeName) {\n                (pageModel) ? pageModel.routeName = urlVals.routeName :\n                    this._pageModels.push(new PageModel(pageName, urlVals.pageItemId, urlVals.routeName));\n            } else if (urlVals.pageItemId) {\n                let defaultRoute = this._labels[pageName];\n                this._pageModels.push(new PageModel(pageName, urlVals.pageItemId, defaultRoute));\n            }\n        }\n    }\n\n    public getLastVisitedPage(pageName: string, pageItemId?: string, isNavButtons: boolean = false): string {\n        let pageModel = this._pageModels.find(p => p.pageName === this._labels[StringHelper.toCamelCase(pageName)] && p.itemId === pageItemId);\n        return pageModel ? pageModel.routeName : undefined;\n    }\n\n    public async getLastVisitedPageUrl(url: string): Promise<string> {\n        let tabName = await this.getPageName(url);\n        let urlvals = (tabName) ? this.getRouteNameAndPageItemId(url, tabName, true) : undefined;\n        let pageModel = this._pageModels.length > 0 ? this._pageModels.find(p => p.pageName === tabName && p.itemId === urlvals.pageItemId) : undefined;\n        return (pageModel) ? url.replace(urlvals.routeName, pageModel.routeName) : url;\n    }\n\n    private clearPageVisitedHistory(): void {\n        this._pageModels = [];\n    }\n\n    private getRouteNameAndPageItemId(url: string, tabName: string, isPageItemIdIndexExist: boolean): any {\n        let urlParts = url.split(\"/\") || [];\n        let index = urlParts.findIndex(p => p === tabName);\n        return {\n            pageItemId: (isPageItemIdIndexExist) ? urlParts[index + 1] || undefined : undefined,\n            routeName: (isPageItemIdIndexExist) ? urlParts[index + 2] || undefined : urlParts[index + 1] || undefined\n        };\n    }\n\n    private async getPageName(url: string): Promise<string> {\n        if (!this._labels) {\n            this._labels = await this._labelService.getGroup(StringHelper.toCamelCase(ObjectHelper.getClassName(this)));\n        }\n\n        if (url.indexOf(this._labels.taskMain) > -1) {\n            return this._labels.taskMain;\n        } else if (url.indexOf(this._labels.propertySafetyMain) > -1) {\n            return this._labels.propertySafetyMain;\n        } else if (url.indexOf(this._labels.applianceMain) > -1) {\n            return this._labels.applianceMain;\n        } else if (url.indexOf(this._labels.partsMain) > -1) {\n            return this._labels.partsMain;\n        } else if (url.indexOf(this._labels.consumablesMain) > -1) {\n            return this._labels.consumablesMain;\n        } else {\n            return undefined;\n        }\n    }\n\n    private isPageItemIDRequired(url: string): boolean {\n        if (url.indexOf(this._labels.taskMain) > -1 || url.indexOf(this._labels.applianceMain) > -1) {\n            return true;\n        } else {\n            return false;\n        }\n    }\n}\n"],"sourceRoot":"../../.."}
{"version":3,"sources":["hema/api/services/fftService.ts"],"names":[],"mappings":"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","file":"fftService.js","sourcesContent":["/// <reference path=\"../../../../typings/app.d.ts\" />\n\nimport { inject } from \"aurelia-framework\";\nimport { IFFTService } from \"./interfaces/IFFTService\";\nimport { ResilientService } from \"../../../common/resilience/services/resilientService\";\nimport { FftServiceConstants } from \"./constants/fftServiceConstants\";\nimport { IConfigurationService } from \"../../../common/core/services/IConfigurationService\";\nimport { ConfigurationService } from \"../../../common/core/services/configurationService\";\nimport { IHistoryResponse } from \"../models/fft/jobs/history/IHistoryResponse\";\nimport { IJob } from \"../models/fft/jobs/IJob\";\nimport { IEngineerStatusRequest } from \"../models/fft/engineers/IEngineerStatusRequest\";\nimport { IJobUpdateRequest } from \"../models/fft/jobs/jobupdate/IJobUpdateRequest\";\nimport { IJobStatusRequest } from \"../models/fft/jobs/status/IJobStatusRequest\";\nimport { IWorkListResponse } from \"../models/fft/engineers/worklist/IWorkListResponse\";\nimport { IJobHistory } from \"../models/fft/jobs/history/IJobHistory\";\nimport { IGetJobResponse } from \"../models/fft/jobs/IGetJobResponse\";\nimport { EventAggregator } from \"aurelia-event-aggregator\";\nimport { FftHeaderProvider } from \"./fftHeaderProvider\";\nimport { IHttpHeaderProvider } from \"../../../common/resilience/services/interfaces/IHttpHeaderProvider\";\nimport { IPartsOrderedRequest } from \"../models/fft/jobs/orderparts/IPartsOrderedRequest\";\nimport { IOrderConsumablesRequest } from \"../models/fft/engineers/IOrderConsumablesRequest\";\nimport { IListObject } from \"../models/fft/reference/IListObject\";\nimport { IReferenceDataGroup } from \"../models/fft/reference/IReferenceDataGroup\";\nimport { IListObjectResponse } from \"../models/fft/reference/IListObjectResponse\";\nimport { StorageService } from \"../../business/services/storageService\";\nimport { IStorageService } from \"../../business/services/interfaces/IStorageService\";\nimport { IReferenceDataUpdateRequest } from \"../models/fft/engineers/IReferenceDataUpdateRequest\";\nimport { ResilientHttpClientFactory } from \"../../../common/resilience/services/resilientHttpClientFactory\";\nimport { IPartCollectionResponse } from \"../models/fft/jobs/parts/IPartCollectionResponse\";\nimport { IAmIContractEngineerResponse } from \"../models/fft/engineers/IAmIContractEngineerResponse\";\nimport { IAmIContractEngineer } from \"../models/fft/engineers/IAmIContractEngineer\";\nimport { WuaNetworkDiagnostics } from \"../../../common/core/wuaNetworkDiagnostics\";\n\n@inject(ConfigurationService, StorageService, EventAggregator, FftHeaderProvider, ResilientHttpClientFactory, WuaNetworkDiagnostics)\nexport class FftService extends ResilientService implements IFFTService {\n\n    constructor(configurationService: IConfigurationService, storageService: IStorageService,\n                eventAggregator: EventAggregator, fftHeaderProvider: IHttpHeaderProvider, resilientClientFactory: ResilientHttpClientFactory,\n                wuaNetworkDiagnostics: WuaNetworkDiagnostics) {\n        super(configurationService, FftServiceConstants.ENDPOINT_CONFIGURATION, storageService, eventAggregator, fftHeaderProvider, resilientClientFactory, wuaNetworkDiagnostics);\n    }\n\n    public requestWork(engineerId: string): Promise<void> {\n        // .NOT a resilient call - we want immediate feedback if this has not worked\n        return this.putData<any, void>(\"engineer_requestwork\", {\"engineerId\": engineerId}, {});\n    }\n\n    public getWorkList(engineerId: string, breakCache?: boolean): Promise<IWorkListResponse> {\n        return this.getData<IWorkListResponse>(\"engineer_worklist\", {\"engineerId\": engineerId}, breakCache)\n            .then(response => response ? response : undefined);\n    }\n\n    public orderConsumables(engineerId: string, orderConsumablesRequest: IOrderConsumablesRequest): Promise<void> {\n        return this.putDataResilient(FftServiceConstants.ORDER_CONSUMABLES_ROUTE, {\"engineerId\": engineerId}, orderConsumablesRequest);\n    }\n\n    public getJob(jobId: string, breakCache?: boolean): Promise<IJob> {\n        return this.getData<IGetJobResponse>(\"job\", {\"jobId\": jobId}, breakCache)\n            .then(response => response && response.data ? response.data.job : undefined);\n    }\n\n    public updateJob(jobId: string, jobUpdateRequest: IJobUpdateRequest): Promise<void> {\n        return this.putDataResilient(FftServiceConstants.JOB_UPDATE_ROUTE, {\"jobId\": jobId}, jobUpdateRequest);\n    }\n\n    public jobStatusUpdate(jobId: string, jobStatusUpdateRequest: IJobStatusRequest): Promise<void> {\n        return this.putDataResilient(\"job_status\", {\"jobId\": jobId}, jobStatusUpdateRequest);\n    }\n\n    public engineerStatusUpdate(engineerId: string, engineerStatusUpdateRequest: IEngineerStatusRequest): Promise<void> {\n        return this.putDataResilient(\"engineer_status\", {\"engineerId\": engineerId}, engineerStatusUpdateRequest);\n    }\n\n    public engineerStatusUpdateEod(engineerId: string, engineerStatusUpdateRequest: IEngineerStatusRequest): Promise<void> {\n        // .NOT a resilient call - if it fails the engineer cant sign off\n        return this.putData<IEngineerStatusRequest, void>(\"engineer_status_eod\", {\"engineerId\": engineerId}, engineerStatusUpdateRequest);\n    }\n\n    public getJobHistory(jobId: string, breakCache?: boolean): Promise<IJobHistory> {\n        return this.getData<IHistoryResponse>(\"job_history\", {\"jobId\": jobId}, breakCache)\n            .then(response => response ? response.data : undefined);\n    }\n\n    public getRemoteReferenceDataIndex(): Promise<IListObject[]> {\n        return this.getData<IListObjectResponse>(\"reference_index\", null, true)\n            .then(response => response && response.data && response.data.listObjects ? response.data.listObjects : undefined);\n    }\n\n    public getRemoteReferenceDataCatalog(catalogName: string): Promise<IReferenceDataGroup> {\n        return this.getData<IReferenceDataGroup>(\"reference_catalog\", {\"catalog\": catalogName}, true)\n            .then(response => response && response.meta && response.data ? response : undefined);\n    }\n\n    public updateRemoteReferenceData(referenceDataUpdateRequest: IReferenceDataUpdateRequest): Promise<void> {\n        return this.putDataResilient(\"reference_update\", null, referenceDataUpdateRequest);\n    }\n\n    public orderPartsForJob(jobId: string, partsOrderedRequest: IPartsOrderedRequest): Promise<void> {\n        return this.putDataResilient(FftServiceConstants.ORDER_PARTS_ROUTE, {\"jobId\": jobId}, partsOrderedRequest);\n    }\n\n    public getPartsCollection(jobId: string, breakCache?: boolean): Promise<IPartCollectionResponse> {\n        return this.getData<IPartCollectionResponse>(\"parts_collection\", {\"jobId\": jobId}, breakCache)\n            .then(response => response && response.data && response.data.list ? response : undefined);\n    }\n\n    public getAmIContractEngineerInfo(engineerId: string, breakCache?: boolean): Promise<IAmIContractEngineer> {\n        return this.getData<IAmIContractEngineerResponse>(\"contractor_info\", {\"engineerId\": parseInt(engineerId, 10)}, breakCache)\n            .then(response => response && response.data ? response.data : undefined);\n    }\n}\n"],"sourceRoot":"../../.."}
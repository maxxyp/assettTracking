{"version":3,"sources":["hema/api/services/vanStockService.ts"],"names":[],"mappings":"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","file":"vanStockService.js","sourcesContent":["/// <reference path=\"../../../../typings/app.d.ts\" />\n\nimport { inject } from \"aurelia-framework\";\nimport { VanStockServiceConstants } from \"./constants/vanStockServiceConstants\";\nimport { AssetService } from \"../../../common/core/services/assetService\";\nimport { IAssetService } from \"../../../common/core/services/IAssetService\";\nimport { IVanStockService } from \"./interfaces/IVanStockService\";\nimport { IVanStockPatch } from \"../models/vanStock/IVanStockPatch\";\nimport { ApiException } from \"../../../common/resilience/apiException\";\nimport { IVanStockPatchListItem } from \"../models/vanStock/IVanStockPatchListItem\";\nimport { IMaterial } from \"../models/vanStock/IMaterial\";\nimport { ResilientService } from \"../../../common/resilience/services/resilientService\";\nimport { ConfigurationService } from \"../../../common/core/services/configurationService\";\nimport { StorageService } from \"../../business/services/storageService\";\nimport { EventAggregator } from \"aurelia-event-aggregator\";\nimport { ResilientHttpClientFactory } from \"../../../common/resilience/services/resilientHttpClientFactory\";\nimport { WuaNetworkDiagnostics } from \"../../../common/core/wuaNetworkDiagnostics\";\nimport { IConfigurationService } from \"../../../common/core/services/IConfigurationService\";\nimport { IStorageService } from \"../../business/services/interfaces/IStorageService\";\nimport { IHttpHeaderProvider } from \"../../../common/resilience/services/interfaces/IHttpHeaderProvider\";\nimport { IOnlineMaterialSearchResult } from \"../models/vanStock/IOnlineMaterialSearchResult\";\nimport { IMaterialActions } from \"../models/vanStock/IMaterialActions\";\nimport { VanStockHeaderProvider } from \"./vanStockHeaderProvider\";\n// import { IMaterials } from \"../models/vanStock/IMaterials\";\nimport { IMaterialHighValueTool } from \"../models/vanStock/IMaterialHighValueTool\";\n// import { IMaterialHighValueTools } from \"../models/vanStock/IMaterialHighValueTools\";\nimport { IMaterialZoneUpdateRequest } from \"../models/vanStock/IMaterialZoneUpdateRequest\";\nimport { IMaterialReceiptRequest } from \"../models/vanStock/IMaterialReceiptRequest\";\nimport { IMaterialReturnRequest } from \"../models/vanStock/IMaterialReturnRequest\";\nimport { IMaterialRequestRequest } from \"../models/vanStock/IMaterialRequestRequest\";\nimport { IMaterialTransferRequest } from \"../models/vanStock/IMaterialTransferRequest\";\nimport { IMaterialConsumptionRequest } from \"../models/vanStock/IMaterialConsumptionRequest\";\n\n@inject(AssetService, ConfigurationService, StorageService, EventAggregator, VanStockHeaderProvider, ResilientHttpClientFactory, WuaNetworkDiagnostics)\nexport class VanStockService extends ResilientService implements IVanStockService {\n    private _assetService: IAssetService;\n\n    constructor(assetService: IAssetService, configurationService: IConfigurationService, storageService: IStorageService,\n        eventAggregator: EventAggregator, headerProvider: IHttpHeaderProvider, resilientClientFactory: ResilientHttpClientFactory,\n        wuaNetworkDiagnostics: WuaNetworkDiagnostics) {\n        super(configurationService, \"assetTrackingEndpoint\", storageService, eventAggregator, headerProvider, resilientClientFactory, wuaNetworkDiagnostics);\n        this._assetService = assetService;\n    }\n\n    public async getVanstockPatch(patchCode: string, sector: String): Promise<IVanStockPatch> {\n        try {\n            return this._assetService.loadJson<IVanStockPatch>(`${VanStockServiceConstants.PATCH_VANSTOCK_ENDPOINT}/${sector}/${patchCode}.json`);\n        } catch (error) {\n            throw new ApiException(this, \"getVanstockPatch\", error, undefined, undefined, undefined);\n        }\n    }\n\n    public getVanstockPatchCodes(sector: string): Promise<IVanStockPatchListItem[]> {\n        try {\n            return this._assetService.loadJson<IVanStockPatchListItem[]>(`${VanStockServiceConstants.PATCH_VANSTOCK_ENDPOINT}/${sector}/patch_list.json`);\n        } catch (error) {\n            throw new ApiException(this, \"getVanstockPatchCodes\", error, undefined, undefined, undefined);\n        }\n    }\n\n    public async getEngineerMaterials(engineerId: string): Promise<IMaterial[]> {\n        const response = await this.getData<IMaterial[]>(\"materials\", {\"engineerId\": engineerId});\n        return response || []; // make sure no nulls or undefined go back\n    }\n\n    public async getHighValueTools(): Promise<IMaterialHighValueTool[]> {\n        const response = await this.getData<IMaterialHighValueTool[]>(\"highvaluetools\", null);\n        return response || []; // make sure no nulls or undefined go back\n    }\n\n    public async getEngineerActions(engineerId: string): Promise<IMaterialActions> {\n        return (await this.getData<IMaterialActions>(\"actions\", {\"engineerId\": engineerId}, true))\n                || <IMaterialActions>{\n                    dispatchedMaterials: [],\n                    reservedMaterials: [],\n                    transferredMaterials: []\n                }; // make sure no null or undefined package goes back\n    }\n\n    public async getRemoteMaterialSearch(stockReferenceId: string): Promise<{isInternectConnected: boolean, results: IOnlineMaterialSearchResult[]}> {\n        try {\n            if (this.isInternetConnected()) {\n                let results = await this.getData<IOnlineMaterialSearchResult[]>(\"search\", {materialCode: stockReferenceId}, true);\n                return { isInternectConnected: true, results: results || [] }; // make sure no nulls or undefined go back\n            } else {\n                return { isInternectConnected: false, results: []};\n            }\n        } catch (error) {\n            if (error instanceof ApiException) {\n                const apiException = error as ApiException;\n                if (apiException.httpStatusCode && apiException.httpStatusCode[0] === \"4\" /* any 400, 404 etc codes */) {\n                    return { isInternectConnected: true, results: [] };\n                }\n            }\n            throw new ApiException(this, \"onlineMaterialSearch\", error, undefined, undefined, undefined);\n        }\n    }\n\n    public async sendMaterialZoneUpdate(materialCode: string, data: IMaterialZoneUpdateRequest): Promise<void> {\n        return this.putDataResilient(\n            \"zone\",\n            { materialCode },\n            data\n        );\n    }\n\n    public async sendMaterialReceipt(materialCode: string, data: IMaterialReceiptRequest): Promise<void> {\n        return this.postDataResilient(\n            \"receipt\",\n            { materialCode },\n            data\n        );\n    }\n\n    public async sendMaterialReturn(materialCode: string, data: IMaterialReturnRequest): Promise<void> {\n        return this.postDataResilient(\n            \"return\",\n            { materialCode },\n            data\n        );\n    }\n\n    public async sendMaterialRequest(materialCode: string, data: IMaterialRequestRequest): Promise<void> {\n        return this.postDataResilient(\n            \"reservation\",\n            { materialCode },\n            data\n        );\n    }\n\n    public async sendMaterialRequestUpdate(materialCode: string, data: IMaterialRequestRequest): Promise<void> {\n        return this.putDataResilient(\n            \"reservation\",\n            { materialCode },\n            data\n        );\n    }\n\n    public async sendMaterialTransfer(materialCode: string, data: IMaterialTransferRequest): Promise<void> {\n        return this.postDataResilient(\n            \"transfer\",\n            { materialCode },\n            data\n        );\n    }\n\n    public async sendMaterialConsumption(materialCode: string, data: IMaterialConsumptionRequest): Promise<void> {\n        return this.postDataResilient(\n            \"consumption\",\n            { materialCode },\n            data\n        );\n    }\n}\n"],"sourceRoot":"../../.."}
{"version":3,"sources":["common/ui/elements/incrementalNumberPicker.ts"],"names":[],"mappings":"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","file":"incrementalNumberPicker.js","sourcesContent":["/// <reference path=\"../../../../typings/app.d.ts\" />\n\nimport { bindable, customElement } from \"aurelia-templating\";\nimport { bindingMode } from \"aurelia-binding\";\nimport { DOM } from \"aurelia-pal\";\nimport { inject } from \"aurelia-dependency-injection\";\nimport { Threading } from \"../../../common/core/threading\";\nimport { NumberHelper } from \"../../../common/core/numberHelper\";\n\n@customElement(\"incremental-number-picker\")\n@inject(Element)\nexport class IncrementalNumberPicker {\n    @bindable({ defaultBindingMode: bindingMode.twoWay })\n    public value: number;\n    @bindable({ defaultBindingMode: bindingMode.oneWay })\n    public hideKeyboardOnEnter: boolean;\n    @bindable({ defaultBindingMode: bindingMode.oneWay })\n    public disabled: boolean;\n    @bindable({ defaultBindingMode: bindingMode.oneWay })\n    public readOnly: boolean;\n    @bindable({ defaultBindingMode: bindingMode.oneWay })\n    public cancelDefaultSubmit: boolean;\n    @bindable({ defaultBindingMode: bindingMode.oneWay })\n    public incrementStep: number;\n    @bindable({ defaultBindingMode: bindingMode.oneWay })\n    public minValue: number;\n    @bindable({ defaultBindingMode: bindingMode.oneWay })\n    public maxValue: number;\n    @bindable({ defaultBindingMode: bindingMode.oneWay })\n    public eachSide: boolean;\n    @bindable({ defaultBindingMode: bindingMode.oneWay })\n    public buttonMinusClasses: string;\n    @bindable({ defaultBindingMode: bindingMode.oneWay })\n    public buttonPlusClasses: string;\n\n    private _hasFocus: boolean;\n    private _element: Element;\n    private _oldValue: number;\n\n    constructor(element: Element) {\n        this._element = element;\n    }\n\n    public attached(): void {\n        if (!this.eachSide) {\n            this.eachSide = false;\n        }\n        this._oldValue = this.minValue;\n    }\n\n    public valueChanged(newValue: number, oldValue: number): void {\n        if (oldValue !== undefined && oldValue !== null) {\n            this._oldValue = oldValue;\n        }\n        if (this.isAboveMax(newValue) || this.isBelowMin(newValue)) {\n            Threading.nextCycle(() => {\n                this.value = oldValue;\n            });\n        }\n    }\n\n    public add(): void {\n        this.ensureIncrementHasValue();\n\n        if (!NumberHelper.isNumber(this.value)) {\n            /* when clicking add on an empty value, initialise to:\n                 basementValue if basementValue is non-zero\n                 otherwise basementValue plus incrementValue\n                (in other words, it looks odd if \"add\"\" intialises an empty value to zero)\n            */\n            let basementValue = (this.minValue || 0);\n            this.value = basementValue ? basementValue : basementValue + this.incrementStep;\n        } else {\n            if (!this.isAboveMax(this.value + this.incrementStep)) {\n                this.value = this.value + this.incrementStep;\n            }\n        }\n        this.dispachEvent(\"add\");\n    }\n\n    public subtract(): void {\n        this.ensureIncrementHasValue();\n\n        if (!NumberHelper.isNumber(this.value)) {\n            // when clicking subtract on an empty value, initialise to basement value\n            this.value = this.minValue || 0;\n        } else {\n            if (!this.isBelowMin(this.value - this.incrementStep)) {\n                this.value = this.value - this.incrementStep;\n            }\n        }\n        this.dispachEvent(\"subtract\");\n    }\n\n    public updated(): void {\n        this.dispachEvent(\"updated\");\n    }\n\n    public blur(): void {\n        this._hasFocus = false;\n\n        Threading.nextCycle(() => {\n            if (!this._hasFocus) {\n                this._element.dispatchEvent(DOM.createCustomEvent(\"blur\", {\n                    detail: {\n                        value: this._element\n                    },\n                    bubbles: true\n                }));\n            }\n        });\n\n        if (this.value === undefined || this.value === null) {\n            if (this._oldValue !== undefined && this._oldValue !== null) {\n                this.value = this._oldValue;\n            } else {\n                this.value = this.minValue;\n            }\n        }\n       this.updated();\n    }\n\n    public focus(): void {\n        this._hasFocus = true;\n    }\n\n    public dispachEvent(eventName: string): void {\n        Threading.nextCycle(() => {\n            let myevent: Event = new Event(eventName);\n            if (this._element) {\n                this._element.dispatchEvent(myevent);\n            }\n        });\n    }\n\n    private ensureIncrementHasValue(): void {\n        if (!NumberHelper.isNumber(this.incrementStep)) {\n            this.incrementStep = 1;\n        }\n    }\n\n    private isAboveMax(value: number): boolean {\n        return NumberHelper.isNumber(value) && NumberHelper.isNumber(this.maxValue)\n            && (value > this.maxValue);\n    }\n\n    private isBelowMin(value: number): boolean {\n        return NumberHelper.isNumber(value) && NumberHelper.isNumber(this.minValue)\n            && (value < this.minValue);\n    }\n}\n"],"sourceRoot":"../../.."}
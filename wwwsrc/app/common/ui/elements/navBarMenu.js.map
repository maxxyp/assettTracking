{"version":3,"sources":["common/ui/elements/navBarMenu.ts"],"names":[],"mappings":"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","file":"navBarMenu.js","sourcesContent":["/// <reference path=\"../../../../typings/app.d.ts\" />\n\nimport {EventAggregator} from \"aurelia-event-aggregator\";\nimport {inject, customElement, bindable, bindingMode} from \"aurelia-framework\";\nimport {Router} from \"aurelia-router\";\nimport {Notification} from \"./models/notification\";\nimport {UiConstants} from \"./constants/uiConstants\";\nimport {NavModel} from \"aurelia-router\";\nimport {PlatformHelper} from \"../../core/platformHelper\";\nimport {DomHelper} from \"../../ui/domHelper\";\n\n@customElement(\"nav-bar-menu\")\n@inject(EventAggregator)\nexport class NavBarMenu {\n    @bindable({defaultBindingMode: bindingMode.oneWay})\n    public router: Router;\n    @bindable({defaultBindingMode: bindingMode.oneWay})\n    public notifications: Notification[];\n    @bindable({defaultBindingMode: bindingMode.oneWay})\n    public notificationsTotal: number;\n    @bindable({defaultBindingMode: bindingMode.oneWay})\n    public showMenu: boolean;\n    @bindable({defaultBindingMode: bindingMode.oneWay})\n    public showNotifications: boolean;\n    @bindable({defaultBindingMode: bindingMode.twoWay})\n    public isActive: boolean;\n    @bindable({defaultBindingMode: bindingMode.oneWay})\n    public navBarTitle: string;\n    public homeShowBackButton: boolean;\n    @bindable({defaultBindingMode: bindingMode.oneWay})\n    public overrideShowBackButton: boolean;\n    @bindable({defaultBindingMode: bindingMode.oneWay})\n    public isSimMode: boolean;\n\n    private _lastShow: number;\n    private _eventTarget: EventTarget;\n    private _clickCheck: () => void;\n    private _backEventListener: (eventargs: { handled: boolean }) => void;\n    private _eventAggregator: any;\n\n    constructor(eventAggregator: EventAggregator) {\n        this.showMenu = false;\n        this.showNotifications = false;\n        this.homeShowBackButton = false;\n        this.overrideShowBackButton = false;\n        this.isActive = true;\n        this._eventAggregator = eventAggregator;\n        this._lastShow = 0;\n        this._eventTarget = document;\n        this._clickCheck = () => {\n            // only hide if we have not just shown it\n            if (new Date().getTime() - this._lastShow > 500) {\n                this.hideMenus();\n            }\n        };\n        this._backEventListener = (eventargs: { handled: boolean }) => {\n            eventargs.handled = this.homeShowBackButton;\n\n            if (eventargs.handled) {\n                this.backClicked();\n            }\n        };\n        this._eventAggregator.subscribe(\"router:navigation:complete\", (e: any) => this.checkHomeRoute(e));\n    }\n\n    public setEventTarget(eventTarget: EventTarget): void {\n        this._eventTarget = eventTarget;\n    }\n\n    public attached(): void {\n        if (PlatformHelper.getPlatform() === \"wua\" && window.Windows.UI.Core.SystemNavigationManager) {\n            // to simulate hardware back button on Windows desktop WUA\n            // window.Windows.UI.Core.SystemNavigationManager.getForCurrentView().appViewBackButtonVisibility =\n            //     window.Windows.UI.Core.AppViewBackButtonVisibility.visible;\n            window.Windows.UI.Core.SystemNavigationManager.getForCurrentView()\n                  .addEventListener(\"backrequested\", this._backEventListener);\n        }\n        this.isActiveChanged(this.isActive, false);\n    }\n\n    public detached(): void {\n        this.hideMenus();\n        if (PlatformHelper.getPlatform() === \"wua\" && window.Windows.UI.Core.SystemNavigationManager) {\n            window.Windows.UI.Core\n                  .SystemNavigationManager.removeEventListener(\"backrequested\", this._backEventListener);\n        }\n    }\n\n    public toggleSideMenu(): void {\n        this.showNotifications = false;\n        this.showMenu = this.showMenu === true ? false : true;\n        document.body.classList.toggle(\"noscroll\", this.showMenu);\n        if (this.showMenu) {\n            /* Update the menu entries so any with dynamic visibility update */\n            if (this.router && this.router.navigation) {\n                for (let i: number = 0; i < this.router.navigation.length; i++) {\n                    this.showHideMenuItem(this.router.navigation[i], this.isActive);\n                }\n            }\n            this._lastShow = new Date().getTime();\n            this._eventTarget.addEventListener(\"click\", this._clickCheck);\n        }\n    }\n\n    public toggleNotificationsMenu(): void {\n        this.showMenu = false;\n        this.showNotifications = this.showNotifications === true ? false : true;\n        document.body.classList.toggle(\"noscroll\", this.showMenu);\n        if (this.showNotifications) {\n            this._lastShow = new Date().getTime();\n            this._eventTarget.addEventListener(\"click\", this._clickCheck);\n        }\n    }\n\n    public backClicked(): void {\n        let el: { [id: string]: (() => void)[] } = <{ [id: string]: (() => void)[] }>this._eventAggregator.eventLookup;\n        if (el &&\n            el[UiConstants.EVENT_BACKCLICK] &&\n            el[UiConstants.EVENT_BACKCLICK].length > 0) {\n            this._eventAggregator.publish(UiConstants.EVENT_BACKCLICK);\n        } else {\n            this.router.navigateBack();\n        }\n    }\n\n    public notificationActioned(notification: Notification): void {\n        this.hideMenus();\n        notification.callback();\n    }\n\n    public hideMenus(): void {\n        if (this.showMenu || this.showNotifications) {\n            this._eventTarget.removeEventListener(\"click\", this._clickCheck);\n        }\n        this.showMenu = false;\n        this.showNotifications = false;\n        document.body.classList.toggle(\"noscroll\", false);\n    }\n\n    public navigateTo(navModel: NavModel): void {\n        let settings: { defaultParam: any, callback: (router: Router) => void } = navModel.settings;\n        if (!!settings && settings.callback) {\n            settings.callback(this.router);\n            return;\n        }\n\n        DomHelper.jumpToTop();\n        this.hideMenus();\n        this.router.navigateToRoute(navModel.config.name, settings && settings.defaultParam\n            ? settings.defaultParam : undefined);\n    }\n\n    public isActiveChanged(newValue: boolean, oldValue: boolean): void {\n        for (let i: number = 0; i < this.router.navigation.length; i++) {\n            this.showHideMenuItem(this.router.navigation[i], newValue);\n        }\n    }\n\n    private showHideMenuItem(row: NavModel, isactive: boolean): void {\n        if (row.settings === undefined || row.settings === null) {\n            row.settings = {};\n        }\n        let settings: { authRequired: boolean, ignoreAuthRequired: boolean, showItem: boolean, dynamicVisible: () => boolean } =\n            <{ authRequired: boolean, ignoreAuthRequired: boolean, showItem: boolean, dynamicVisible: () => boolean }>row.settings;\n\n        let show: boolean = true;\n        if (settings.ignoreAuthRequired) {\n            show = true;\n        } else {\n            if (isactive) {\n                if ((settings.authRequired === true ||\n                    settings.authRequired === undefined)) {\n                    show = true;\n                } else {\n                    show = false;\n                }\n            } else {\n                if (!settings.authRequired) {\n                    show = true;\n                } else {\n                    show = false;\n                }\n            }\n        }\n\n        if (settings.dynamicVisible) {\n            show = settings.dynamicVisible();\n        }\n\n        settings.showItem = show;\n    }\n\n    private checkHomeRoute(eventArgs: any): void {\n        if (this.router.currentInstruction.config.navModel.relativeHref.length === 0) {\n            this.homeShowBackButton = false;\n        } else {\n            this.homeShowBackButton = true;\n        }\n    }\n}\n"],"sourceRoot":"../../.."}
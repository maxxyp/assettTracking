{"version":3,"sources":["common/ui/elements/timeRangePicker.ts"],"names":[],"mappings":"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","file":"timeRangePicker.js","sourcesContent":["/// <reference path=\"../../../../typings/app.d.ts\" />\n\nimport { bindable, customElement } from \"aurelia-templating\";\nimport { bindingMode } from \"aurelia-binding\";\nimport * as moment from \"moment\";\nimport { TimeRange } from \"./models/timeRange\";\nimport { inject } from \"aurelia-dependency-injection\";\nimport { DOM } from \"aurelia-pal\";\n@customElement(\"time-range-picker\")\n@inject(Element)\nexport class TimeRangePicker {\n\n    @bindable({ defaultBindingMode: bindingMode.twoWay })\n    public value: TimeRange;\n    @bindable({ defaultBindingMode: bindingMode.oneWay })\n    public startTimeDisabled: boolean;\n    @bindable({ defaultBindingMode: bindingMode.oneWay })\n    public endTimeDisabled: boolean;\n    @bindable({ defaultBindingMode: bindingMode.oneWay })\n    public readOnly: boolean;\n    @bindable({ defaultBindingMode: bindingMode.oneWay })\n    public startTimeLabel: string;\n    @bindable({ defaultBindingMode: bindingMode.oneWay })\n    public endTimeLabel: string;\n    @bindable({ defaultBindingMode: bindingMode.oneWay })\n    public intervalInMinutes: number;\n    @bindable({ defaultBindingMode: bindingMode.oneWay })\n    public buttonContainerClasses: string;\n    @bindable({ defaultBindingMode: bindingMode.oneWay })\n    public buttonMinusClasses: string;\n    @bindable({ defaultBindingMode: bindingMode.oneWay })\n    public buttonPlusClasses: string;\n    @bindable({ defaultBindingMode: bindingMode.oneWay })\n    public hideKeyboardOnEnter: boolean;\n    @bindable({ defaultBindingMode: bindingMode.twoWay })\n    public durationInMinutes: number;\n    @bindable({ defaultBindingMode: bindingMode.oneWay })\n    public controlContainerClasses: string;\n    @bindable({ defaultBindingMode: bindingMode.twoWay })\n    public startTime: string;\n    @bindable({ defaultBindingMode: bindingMode.twoWay })\n    public endTime: string;\n    @bindable({ defaultBindingMode: bindingMode.oneWay })\n    public eachSide: boolean;\n\n    private _internalValueChange: boolean;\n    private _element: Element;\n    private _timeFormatRegEx: RegExp;\n\n    constructor(element: Element) {\n        this._timeFormatRegEx = /^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/;\n        this.startTimeLabel = \"Start time\";\n        this.endTimeLabel = \"End time\";\n        this.intervalInMinutes = 5;\n        this.durationInMinutes = 5;\n        this.startTimeDisabled = false;\n        this.endTimeDisabled = false;\n        this._element = element;\n    }\n\n    public valueChanged(newValue: TimeRange, oldValue: TimeRange): void {\n        if (!this._internalValueChange) {\n            let currentStartTime = this.value ? this.value.startTime : \"\";\n            let currentEndTime = this.value ? this.value.endTime : \"\";\n            if (this.startTime !== currentStartTime) {\n                this.startTime = currentStartTime;\n            }\n            if (this.endTime !== currentEndTime) {\n                this.endTime = currentEndTime;\n            }\n\n            this.updateDuration();\n        }\n    }\n\n    public startTimeChanged(newValue: string, oldValue: string): void {\n        this._internalValueChange = true;\n\n        let currentEndTime = this.value ? this.value.endTime : this.endTime;\n        if (this._timeFormatRegEx.test(this.startTime)) {\n            if (!this.isStartDateGreaterThanEnd(this.startTime, currentEndTime)) {\n                this.value = new TimeRange(this.startTime, currentEndTime);\n            } else {\n                this.startTime = currentEndTime;\n                this.value = new TimeRange(currentEndTime, currentEndTime);\n            }\n        } else {\n            this.value = undefined;\n        }\n        this.updateDuration();\n        this._internalValueChange = false;\n    }\n\n    public endTimeChanged(newValue: string, oldValue: string): void {\n        this._internalValueChange = true;\n        let currentStartTime = this.value ? this.value.startTime : this.startTime;\n        if (this._timeFormatRegEx.test(this.endTime)) {\n            if (!this.isStartDateGreaterThanEnd(currentStartTime, this.endTime)) {\n                this.value = new TimeRange(currentStartTime, this.endTime);\n            } else {\n                this.endTime = currentStartTime;\n                this.value = new TimeRange(currentStartTime, currentStartTime);\n            }\n        } else {\n            this.value = undefined;\n        }\n        this.updateDuration();\n        this._internalValueChange = false;\n    }\n\n    public blur(): void {\n        this._element.dispatchEvent(DOM.createCustomEvent(\"blur\", {\n            detail: {\n                value: this._element\n            },\n            bubbles: true\n        }));\n    }\n\n    private updateDuration(): void {\n        if (this._timeFormatRegEx.test(this.startTime) && this._timeFormatRegEx.test(this.endTime)) {\n            this.durationInMinutes = this.getDuration(this.value);\n        } else {\n            this.durationInMinutes = 0;\n        }\n    }\n\n    private getTime(time: string): Date {\n        if (time) {\n            let hours = parseInt(time.split(\":\")[0], 10);\n            let minutes = parseInt(time.split(\":\")[1], 10);\n            let currentDate = moment();\n            currentDate.set(\"hours\", hours);\n            currentDate.set(\"minutes\", minutes);\n            return currentDate.toDate();\n        } else {\n            return null;\n        }\n    }\n\n    private isStartDateGreaterThanEnd(startTime: string, endTime: string): boolean {\n        let flag: boolean = false;\n        let start: Date = this.getTime(startTime);\n        let end: Date = this.getTime(endTime);\n        if (start && end) {\n            flag = start.getTime() > end.getTime();\n        }\n        return flag;\n    }\n\n    private getDuration(time: TimeRange): number {\n        if (time) {\n            let duration: number;\n            let logStartTime: Date = null;\n            let workEndTime: Date = null;\n\n            if (time.startTime) {\n                logStartTime = this.getTime(time.startTime);\n            }\n\n            if (time.endTime) {\n                workEndTime = this.getTime(time.endTime);\n            }\n\n            if (logStartTime && workEndTime) {\n                duration = moment(workEndTime).diff(moment(logStartTime), \"minutes\");\n            } else if (logStartTime) {\n                duration = moment(new Date()).diff(moment(logStartTime), \"minutes\");\n            }\n\n            // convert to nearst of minutes interval\n            if (duration && duration > 0) {\n                return Math.ceil(duration / this.intervalInMinutes) * this.intervalInMinutes;\n            } else if (duration === 0) {\n                return 0;\n            } else {\n                return this.intervalInMinutes;\n            }\n        } else {\n            return null;\n        }\n    }\n}\n"],"sourceRoot":"../../.."}